name: Powerwall Mode Auto

on:
  workflow_dispatch:
    inputs:
      mode:
        description: 'Powerwall mode to set'
        required: true
        default: 'self_consumption'
  schedule:
    # 05:30 UK time (UTC)
    - cron: '05 16 * * *'

jobs:
  set-self-use:
    runs-on: ubuntu-latest

    steps:
      - name: Set Powerwall to Self-Powered
        run: |
          curl -X POST "https://api.teslemetry.com/api/1/energy_sites/${{ secrets.TESLEMETRY_SITE_ID }}/operation" \
            -H "Authorization: Bearer ${{ secrets.TESLEMETRY_API_KEY }}" \
            -H "Content-Type: application/x-www-form-urlencoded" \
            -d "default_real_mode=${{ secrets.DEFAULT_REAL_MODE }}"
